import{d as Y,N as J,O as W,o as c,E as S,s as me,a as $,c as T,b as e,w as a,h as y,I as E,H as B,g as P,i as h,G as X,K as A,u as re,Q as F,e as j,S as de,r as Z,x as _e,n as ce}from"./index-D8gctr5_.js";import{s as D}from"./Api-B7vETOhA.js";import{_ as pe,a as ve}from"./index-Bd6qioH6.js";import{_ as H,B as ee}from"./_plugin-vue_export-helper-zm96i73Z.js";import{a as fe,d as ge,f as q,R as ye}from"./index-CXoRKUPg.js";import{u as we}from"./user-Siu6mg7I.js";import{M as V}from"./index-UCcfnG2Q.js";import{a as te,S as ae}from"./index-_Mjgpjnj.js";import{_ as ne,F as oe}from"./index-BXbfQMdS.js";import{I as le,a as ke}from"./index-DAaq9sM0.js";import{_ as be}from"./index-FW7-rRWH.js";import{_ as he}from"./index-CKtRlflV.js";import"./css-Bg5AX7vO.js";import"./pickAttrs-BBGk6uJf.js";import"./index-BNvgjLyG.js";import"./shallowequal-ByiV2moS.js";import"./index-riEwGd59.js";const xe=Y({__name:"Pagination",props:J({total:{type:Number,required:!0}},{page:{},pageModifiers:{},pageSize:{},pageSizeModifiers:{}}),emits:J(["changePageEmit"],["update:page","update:pageSize"]),setup(x,{emit:z}){const r=z,t=W(x,"page"),o=W(x,"pageSize"),p=(v,d)=>{r("changePageEmit",v,d)};return(v,d)=>{const w=pe;return c(),S(w,{class:"pagination-wrap",current:t.value,"onUpdate:current":d[0]||(d[0]=i=>t.value=i),"page-size":o.value,"onUpdate:pageSize":d[1]||(d[1]=i=>o.value=i),total:x.total,onChange:p,onShowSizeChange:p,"show-total":i=>`总共: ${i} 条`},null,8,["current","page-size","total","show-total"])}}}),Ce=H(xe,[["__scopeId","data-v-368840e3"]]),ie=[{label:"待审核",value:2},{label:"显示",value:1},{label:"隐藏",value:0}],se=[{label:"是",value:1},{label:"否",value:0}],Se=Y({__name:"TableAction",props:["row"],setup(x){const{userIdp:z}=we(),r=x,t=me("updateTable"),o=$(!1),p=$(!1),v=$([]),d=$({status:1,like_count:0}),w=()=>{i.value={isAdmin:0,replay_comment_id:0,comment_email:"",short_time_name:"",comment_content:""}},i=$({isAdmin:0,replay_comment_id:0,comment_email:"",short_time_name:"",comment_content:""}),k=async u=>{const{code:n}=await D.deleteComment(u);n===200&&(h.success("删除成功"),t(!0))},s=()=>{V.confirm({title:"删除",content:`确定删除评论  ${r.row.comment_content}  吗？`,onOk(){k(r.row.comment_id)}})},C=()=>{d.value={status:r.row.status,like_count:r.row.like_count},o.value=!0},f=(u,n)=>`${n+1} 楼(昵称:${u.short_time_name}, 邮箱:${u.comment_email}): ${u.comment_content}`,L=u=>(console.log(u),u.map((n,_)=>X("p",{innerHTML:f(n,_),style:{color:n.comment_id===r.row.comment_id?"green":"black",marginBottom:"10px"}}))),I=async()=>{const{code:u,data:n}=await D.getArticleComment(r.row.article_id);if(u!==200){h.error("获取评论详情失败");return}return v.value=n,n},g=async()=>{const{code:u,data:n}=await D.getArticleDetail(`${r.row.article_id}`);if(u!==200){h.error("获取失败");return}if(!n||!n.article_title){h.error("文章已删除");return}const _=await I();_&&V.info({title:`评论详情-文章: ${n.article_title}`,content:X("div",{},[...L(_||[])]),onOk(){},style:{width:"1000px"}})},M=async()=>{const{status:u,like_count:n}=d.value,{code:_}=await D.updateComment(r.row.comment_id,{status:u,like_count:n});_===200?(h.success("更新成功"),o.value=!1,t()):h.error("更新失败")},U=async()=>{await I(),w(),i.value.replay_comment_id=r.row.parent_comment_id||r.row.comment_id,p.value=!0},l=async()=>{const{isAdmin:u,replay_comment_id:n,comment_email:_,short_time_name:R,comment_content:O}=i.value;if(!O){h.error("回复内容不能为空");return}if(u===0&&(!_||!R)){h.error("昵称和邮箱不能为空");return}const b={is_admin:u,parent_comment_id:n,comment_email:u===0?_:"admin@admin.com",short_time_name:u===0?R:"作者回复",comment_content:O,create_time:fe(ge()),article_id:r.row.article_id,user_idp:u?"admin":z},{code:N}=await D.replyComment(b.parent_comment_id,b);N===200&&(h.success("回复成功"),p.value=!1,t())};return(u,n)=>{const _=ee,R=ae,O=te,b=ne,N=be,K=oe,G=V,Q=le,ue=ke;return c(),T("div",null,[e(_,{type:"primary",danger:"",onClick:s,size:"small",class:"mg-10"},{default:a(()=>[y(" 删除 ")]),_:1}),e(_,{type:"primary",onClick:g,size:"small",class:"mg-10"},{default:a(()=>[y(" 查看详情 ")]),_:1}),e(_,{type:"default",onClick:C,size:"small",class:"mg-10"},{default:a(()=>[y(" 更新状态 ")]),_:1}),e(_,{type:"default",onClick:U,size:"small"},{default:a(()=>[y(" 回复一级评论 ")]),_:1}),e(G,{open:o.value,"onUpdate:open":n[2]||(n[2]=m=>o.value=m),title:"修改状态",onOk:M,style:{width:"300px"}},{default:a(()=>[e(K,null,{default:a(()=>[e(b,{label:"评论状态"},{default:a(()=>[e(O,{value:d.value.status,"onUpdate:value":n[0]||(n[0]=m=>d.value.status=m),placeholder:"选择评论状态",style:{width:"88px"}},{default:a(()=>[(c(!0),T(E,null,B(P(ie),m=>(c(),S(R,{key:m.label,value:m.value},{default:a(()=>[y(A(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(b,{label:"喜欢数量"},{default:a(()=>[e(N,{value:d.value.like_count,"onUpdate:value":n[1]||(n[1]=m=>d.value.like_count=m)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"]),e(G,{open:p.value,"onUpdate:open":n[7]||(n[7]=m=>p.value=m),title:"回复一级评论",onOk:l,style:{width:"1000px"}},{default:a(()=>[e(K,null,{default:a(()=>[e(b,{label:"管理员回复?:"},{default:a(()=>[e(O,{value:i.value.isAdmin,"onUpdate:value":n[3]||(n[3]=m=>i.value.isAdmin=m),style:{width:"300px"}},{default:a(()=>[(c(!0),T(E,null,B(P(se),m=>(c(),S(R,{key:m.label,value:m.value},{default:a(()=>[y(A(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(b,{label:"您的昵称"},{default:a(()=>[e(Q,{value:i.value.short_time_name,"onUpdate:value":n[4]||(n[4]=m=>i.value.short_time_name=m),disabled:!!i.value.isAdmin},null,8,["value","disabled"])]),_:1}),e(b,{label:"您的邮箱"},{default:a(()=>[e(Q,{value:i.value.comment_email,"onUpdate:value":n[5]||(n[5]=m=>i.value.comment_email=m),disabled:!!i.value.isAdmin},null,8,["value","disabled"])]),_:1}),e(b,{label:"您的评论"},{default:a(()=>[e(ue,{rows:4,type:"textarea","max-length":50,value:i.value.comment_content,"onUpdate:value":n[6]||(n[6]=m=>i.value.comment_content=m)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),ze=H(Se,[["__scopeId","data-v-79ff2bf9"]]),Ie=["onClick"],Ue={style:{width:"300px"}},Re=["innerHTML"],$e="calc(100vh - 320px)",Te=Y({__name:"Table",props:{commentList:{type:Array,required:!0}},emits:["update"],setup(x){const z=re(),r=$([{title:"id",dataIndex:"comment_id",key:"comment_id",width:50},{title:"昵称",dataIndex:"short_time_name",key:"short_time_name",width:100},{title:"内容",dataIndex:"comment_content",key:"comment_content",width:200},{title:"邮箱",dataIndex:"comment_email",key:"comment_id",width:150},{title:"文章id",dataIndex:"article_id",key:"article_id",width:90},{title:"管理员评论",dataIndex:"is_admin",key:"is_admin",width:80,customRender:({text:o})=>o===1?"是":"否"},{title:"父评论id",dataIndex:"parent_comment_id",key:"parent_comment_id",width:90,customRender:({text:o})=>o||""},{title:"用户id(已加密)",dataIndex:"user_idp",key:"user_idp",width:200},{title:"喜欢量",dataIndex:"like_count",key:"like_count",width:100},{title:"创建时间",dataIndex:"create_time",key:"create_time",width:180,customRender({text:o}){return q(o)}},{title:"状态",dataIndex:"status",key:"status",width:80,customRender:({text:o})=>({1:"显示",0:"隐藏",2:"待审核"})[o]||"未知"},{title:"操作",dataIndex:"action",key:"action"}]),t=o=>{z.push({path:"/layout/article-list",query:{id:o}})};return(o,p)=>{const v=he,d=ve;return c(),S(d,{rowKey:"comment_id","data-source":x.commentList,pagination:!1,columns:r.value,scroll:{scrollToFirstRowOnChange:!0,y:$e}},{bodyCell:a(({column:w,text:i,record:k})=>[w.key==="article_id"?(c(),T("a",{key:0,onClick:s=>t(k.article_id)},A(i),9,Ie)):F("",!0),w.key==="action"?(c(),S(ze,{key:1,onUpdate:p[0]||(p[0]=s=>o.$emit("update")),row:k},null,8,["row"])):F("",!0),w.key==="comment_content"?(c(),S(v,{key:2,title:"预览"},{content:a(()=>[j("div",Ue,[j("p",{class:"preview-p",innerHTML:i},null,8,Re)])]),default:a(()=>[j("p",null,A(i?i.slice(0,20):""),1)]),_:2},1024)):F("",!0)]),_:1},8,["data-source","columns","scroll"])}}}),Me=H(Te,[["__scopeId","data-v-c1e9b4f6"]]),De=Y({__name:"index",setup(x){const z=de(),{query:r}=z,t=Z({is_admin:"",parent_comment_id:"",comment_id:r.id?r.id:"",article_id:"",user_idp:"",create_time:[null,null],status:""}),o=Z({page:1,pageSize:20,total:0}),p=$([]);_e(async()=>{await v(t)});const v=async k=>{k=k||t;const{parent_comment_id:s="",is_admin:C="",user_idp:f="",comment_id:L="",article_id:I="",create_time:g=[null,null],status:M=""}=k,U={is_admin:C,parent_comment_id:s,comment_id:L,user_idp:f,article_id:I,status:M};g&&g[0]&&g[1]&&(U.create_time_start=q(g[0],"YYYY-MM-DD"),U.create_time_end=q(g[1],"YYYY-MM-DD"));const{code:l,data:u,pageInfo:{pageSize:n=10,page:_=1,total:R=0}}=await D.getCommentList({...U,...o});l===200&&(p.value=u,o.page=_,o.pageSize=n,o.total=R)},d=()=>{v({...t})},w=()=>{v({...t})},i=()=>{t.parent_comment_id="",t.comment_id="",t.article_id="",t.user_idp="",t.is_admin="",t.create_time=[null,null],t.status="",o.page=1,o.pageSize=20,v({...t})};return ce("updateTable",v),(k,s)=>{const C=le,f=ne,L=ye,I=ae,g=te,M=ee,U=oe;return c(),T(E,null,[e(U,{layout:"inline",model:t,class:"comment_form"},{default:a(()=>[e(f,null,{default:a(()=>[e(C,{value:t.parent_comment_id,"onUpdate:value":s[0]||(s[0]=l=>t.parent_comment_id=l),placeholder:"评论父id(搜索)"},null,8,["value"])]),_:1}),e(f,null,{default:a(()=>[e(C,{value:t.comment_id,"onUpdate:value":s[1]||(s[1]=l=>t.comment_id=l),placeholder:"评论主id(搜索)"},null,8,["value"])]),_:1}),e(f,null,{default:a(()=>[e(C,{value:t.article_id,"onUpdate:value":s[2]||(s[2]=l=>t.article_id=l),placeholder:"文章id(搜索)"},null,8,["value"])]),_:1}),e(f,null,{default:a(()=>[e(C,{value:t.user_idp,"onUpdate:value":s[3]||(s[3]=l=>t.user_idp=l),valueModifiers:{trim:!0},placeholder:"用户id(搜索)"},null,8,["value"])]),_:1}),e(f,{label:"评论时间"},{default:a(()=>[e(L,{value:t.create_time,"onUpdate:value":s[4]||(s[4]=l=>t.create_time=l)},null,8,["value"])]),_:1}),e(f,{label:"状态"},{default:a(()=>[e(g,{value:t.status,"onUpdate:value":s[5]||(s[5]=l=>t.status=l),style:{width:"100px"},placeholder:"全部"},{default:a(()=>[(c(!0),T(E,null,B(P(ie),l=>(c(),S(I,{key:l.label,value:l.value},{default:a(()=>[y(A(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(f,{label:"管理员评论"},{default:a(()=>[e(g,{value:t.is_admin,"onUpdate:value":s[6]||(s[6]=l=>t.is_admin=l),style:{width:"100px"},placeholder:"全部"},{default:a(()=>[(c(!0),T(E,null,B(P(se),l=>(c(),S(I,{key:l.label,value:l.value},{default:a(()=>[y(A(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(f,null,{default:a(()=>[e(M,{type:"primary","html-type":"submit",onClick:w},{default:a(()=>[y(" 查询 ")]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(M,{type:"primary","html-type":"submit",onClick:i},{default:a(()=>[y(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"]),e(Me,{commentList:p.value,onUpdate:s[7]||(s[7]=l=>v(t))},null,8,["commentList"]),e(Ce,{onChangePageEmit:d,page:o.page,"onUpdate:page":s[8]||(s[8]=l=>o.page=l),"page-size":o.pageSize,"onUpdate:pageSize":s[9]||(s[9]=l=>o.pageSize=l),total:o.total},null,8,["page","page-size","total"])],64)}}}),We=H(De,[["__scopeId","data-v-b2e848ff"]]);export{We as default};
